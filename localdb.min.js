"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(){function e(e){for(var t=0;t<e.length;t++)if(!e[t])return!1;return!0}function t(){var e=((new Date).getTime()/1e3|0).toString(16);return e+"xxxxxxxxxxxxxxxx".replace(/[x]/g,function(){return(16*Math.random()|0).toString(16)}).toLowerCase()}var r={limit:0,sortBy:"index",sort:1,skip:0},n=function(n,i){var s=function(){function n(e){var t=arguments.length<=1||void 0===arguments[1]?"Array":arguments[1],r=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];if(_classCallCheck(this,n),"string"==typeof e)this.db=e,this.type=t,this.timestamp=r;else if("object"==typeof e){var i=e;this.db=i.name,this.type=i.type||"Array",this.timestamp=i.timestamp||!1}this.populate_keys=null}return _createClass(n,[{key:"get",value:function(e){var t=JSON.parse(i.getItem(this.db));return e||"number"==typeof e?"undefined"!=typeof t&&t?t[e]:null:t}},{key:"findOne",value:function(e){return this.find(e,{limit:1})}},{key:"find",value:function(t){var i=this,s=arguments.length<=1||void 0===arguments[1]?r:arguments[1];if("Array"!==this.type)return console.error("The .findOne method only works if the database is an Array!");s.limit=s.limit||r.limit,s.sortBy=s.sortBy||r.sortBy,s.sort=s.sort||r.sort,s.skip=s.skip||r.skip;var a=this.get()||[];t&&(a=a.filter(function(r){var n=[];for(var i in t)n.push(r[i]===t[i]);return e(n)?!0:!1})),1===s.limit&&0===s.skip?a=a[0]:(a=a.sort(function(e,t){return e[s.sortBy]<t[s.sortBy]?-s.sort:e[s.sortBy]>t[s.sortBy]?s.sort:0}),a=0===s.limit?a.slice(s.skip):a.slice(s.skip,s.limit+s.skip));var o=function(e){return i.populate_keys&&i.populate_keys.length>0&&i.populate_keys.forEach(function(t){var r=e[t];if(r){var i=new n(r.__className,"Array"),s=i.findOne({_id:r.objectId});e[t]=s}}),e};return Array.isArray(a)?a.forEach(function(e){e=o(e)}):"object"==typeof a&&(a=o(a)),this.populate_keys=null,a}},{key:"add",value:function(e){"Array"!==this.type&&console.error("The .add method only works if the database is an Array!");var t=this.get()||[],r=0;return t&&t.length>0&&(r=t.length),e=this.initObj(r,e),t.push(e),this.override(t),this}},{key:"initObj",value:function(e,r){return r.index=e,r._id||(r._id=t()),this.timestamp&&(r.createdAt||(r.createdAt=new Date),r.updatedAt=new Date),r}},{key:"set",value:function(e,t){if("Object"!==this.type)console.error("The .set method only works if the database is an Object!");else{var r=this.get()||{};r[e]=t,this.override(r)}return this}},{key:"inc",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1];return this.incOrDec("inc",e,t)}},{key:"dec",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?1:arguments[1];return this.incOrDec("dec",e,t)}},{key:"incOrDec",value:function(e,t){var r=arguments.length<=2||void 0===arguments[2]?1:arguments[2];if("Object"!==this.type)console.error("The .set method only works if the database is an Object!");else{var n=this.get()||{};"inc"===e?n[t]=(n[t]||0)+r:"dec"===e&&(n[t]=(n[t]||0)-r),this.override(n)}return this}},{key:"save",value:function(e){"Array"!==this.type&&console.error("The .save method only works if the database is an Array!");var t=this.get();return t[e.index]._id===e._id&&(t[e.index]=e,this.override(t)),this}},{key:"extend",value:function(e){return e?{__type:"Pointer",__className:this.db,objectId:e}:console.error("You should provide an objectId to reference")}},{key:"populate",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return this.populate_keys=t,this}},{key:"override",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];if("Array"===this.type&&t)for(var r=0;r<e.length;r++)e[r]=this.initObj(r,e[r]);return i.setItem(this.db,JSON.stringify(e)),this}},{key:"remove",value:function(e,t){var r=this.get();if("Array"===this.type){if(0===r.length)return this;r=r.filter(function(r){return r[e]===t?!1:!0});for(var n=0;n<r.length;n++)r[n].index=n}else"Object"===this.type&&delete r[e];return i.setItem(this.db,JSON.stringify(r)),this}},{key:"destroy",value:function(){return i.removeItem(this.db),this}}]),n}();return s};!function(e,t,r){"undefined"!=typeof module?module.exports=r:"undefined"!=typeof e&&(e[t]=r)}(window,"localdb",n(window,window.localStorage))}();
//# sourceMappingURL=localdb.min.js.map
